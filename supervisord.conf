[supervisord]
# Run in foreground (not as daemon) so Docker can track the process.
nodaemon=true
# Disable logging to file (logs go to stdout/stderr instead).
logfile=/dev/null
logfile_maxbytes=0

[program:nginx]
# Run nginx in foreground mode.
command=nginx -g "daemon off;"
# Redirect logs to Docker's stdout/stderr for Cloud Run logging.
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:pirates-server]
# Run the Go backend server.
command=/pirates-server
# Set PORT=8081 so it doesn't conflict with nginx on port 8080.
# nginx will proxy /pirates.v1.PiratesService/* requests to this port.
environment=PORT="8081"
# Redirect logs to Docker's stdout/stderr for Cloud Run logging.
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
